<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="IE=edge;chrome=1" http-equiv="X-UA-Compatible" />
    <title>dev@cloudburo | The Anatomy of a EB based Microservice - Github Docker Integration</title>
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" /><!--[if lt IE 9]><script src="../../../js/ie8.js"></script><![endif]--><link href="../../../css/all.css" rel="stylesheet" /><script type="text/javascript">
      (function(d,e,j,h,f,c,b){d.GoogleAnalyticsObject=f;d[f]=d[f]||function(){(d[f].q=d[f].q||[]).push(arguments)},d[f].l=1*new Date();c=e.createElement(j),b=e.getElementsByTagName(j)[0];c.async=1;c.src=h;b.parentNode.insertBefore(c,b)})(window,document,"script","//www.google-analytics.com/analytics.js","ga");ga("create","UA-35696879-1", location.hostname);ga("send","pageview");
    </script>
    <link href="/favicon.png" rel="icon" type="image/png" />
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro%3A400%2C400italic%2C700" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Varela+Round" rel="stylesheet" />
    <!--HTML5 shiv for IE8 support--><!--[if lt IE 9]
    | <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script-->
  </head>
  <body>
    <div class="col-sm-3 sidebar" id="secondary" style="display: none;">
      <aside>
        <div class="about">
          <h4>
            <a class="sidebarlink" href="/"><i class="fa fa-chevron-right"></i>    Home     <i class="fa fa-home"></i></a>
          </h4>
          <h4>
            <a class="sidebarlink" href="/menu1.html"><i class="fa fa-chevron-right"></i>    About   </a>
          </h4>
          <h4>
            <a class="sidebarlink" href="/menu2.html"><i class="fa fa-chevron-right"></i>    Contact   </a>
          </h4>
        </div>
        <div class="tags">
          <h4>
            Categories
          </h4>
          <ul class="list-unstyled">
            <a href="/tags/ai.html" class="label label-default">ai (2)</a>
            <a href="/tags/api.html" class="label label-default">api (2)</a>
            <a href="/tags/architecture.html" class="label label-default">architecture (26)</a>
            <a href="/tags/aws.html" class="label label-default">aws (13)</a>
            <a href="/tags/banking.html" class="label label-default">banking (7)</a>
            <a href="/tags/bigdata.html" class="label label-default">bigdata (2)</a>
            <a href="/tags/blockchain.html" class="label label-default">blockchain (23)</a>
            <a href="/tags/blockstack.html" class="label label-default">blockstack (1)</a>
            <a href="/tags/bots.html" class="label label-default">bots (2)</a>
            <a href="/tags/cloud.html" class="label label-default">cloud (3)</a>
            <a href="/tags/crypto.html" class="label label-default">crypto (7)</a>
            <a href="/tags/dao.html" class="label label-default">dao (4)</a>
            <a href="/tags/datascience.html" class="label label-default">datascience (3)</a>
            <a href="/tags/deutsch.html" class="label label-default">deutsch (1)</a>
            <a href="/tags/devops.html" class="label label-default">devops (1)</a>
            <a href="/tags/diagram.html" class="label label-default">diagram (1)</a>
            <a href="/tags/diagrammer.html" class="label label-default">diagrammer (1)</a>
            <a href="/tags/docker.html" class="label label-default">docker (11)</a>
            <a href="/tags/economy.html" class="label label-default">economy (1)</a>
            <a href="/tags/ethereum.html" class="label label-default">ethereum (4)</a>
            <a href="/tags/futurework.html" class="label label-default">futureWork (5)</a>
            <a href="/tags/gdpr.html" class="label label-default">gdpr (3)</a>
            <a href="/tags/googleapps.html" class="label label-default">googleapps (1)</a>
            <a href="/tags/gradle.html" class="label label-default">gradle (3)</a>
            <a href="/tags/identity.html" class="label label-default">identity (1)</a>
            <a href="/tags/inspiration.html" class="label label-default">inspiration (15)</a>
            <a href="/tags/intellij.html" class="label label-default">intellij (1)</a>
            <a href="/tags/java.html" class="label label-default">java (3)</a>
            <a href="/tags/javatutorial.html" class="label label-default">javatutorial (5)</a>
            <a href="/tags/journalism.html" class="label label-default">journalism (2)</a>
            <a href="/tags/legal.html" class="label label-default">legal (1)</a>
            <a href="/tags/marketing.html" class="label label-default">marketing (2)</a>
            <a href="/tags/meteor.html" class="label label-default">meteor (5)</a>
            <a href="/tags/microservice.html" class="label label-default">microservice (18)</a>
            <a href="/tags/ml.html" class="label label-default">ml (2)</a>
            <a href="/tags/modeling.html" class="label label-default">modeling (1)</a>
            <a href="/tags/personaldata.html" class="label label-default">personalData (5)</a>
            <a href="/tags/platform.html" class="label label-default">platform (2)</a>
            <a href="/tags/polkadot.html" class="label label-default">polkadot (6)</a>
            <a href="/tags/python.html" class="label label-default">python (7)</a>
            <a href="/tags/quicktips.html" class="label label-default">quicktips (20)</a>
            <a href="/tags/shift.html" class="label label-default">shift (4)</a>
            <a href="/tags/smallhints.html" class="label label-default">smallhints (13)</a>
            <a href="/tags/startup.html" class="label label-default">startup (11)</a>
            <a href="/tags/statistics.html" class="label label-default">statistics (2)</a>
            <a href="/tags/teambuilding.html" class="label label-default">teambuilding (2)</a>
            <a href="/tags/tut01.html" class="label label-default">tut01 (7)</a>
            <a href="/tags/tutorial.html" class="label label-default">tutorial (11)</a>
          </ul>
        </div>
        <div class="timeline">
          <h4>
            By year
          </h4>
          <ul class="list-unstyled">
            <a href="/2019.html" class="label label-primary">2019 (25)</a>
            <a href="/2018.html" class="label label-primary">2018 (33)</a>
            <a href="/2017.html" class="label label-primary">2017 (18)</a>
            <a href="/2016.html" class="label label-primary">2016 (16)</a>
            <a href="/2015.html" class="label label-primary">2015 (35)</a>
            <a href="/2014.html" class="label label-primary">2014 (10)</a>
          </ul>
        </div>
      </aside>
    </div>
    <!--/#secondary-->
    <div class="col-sm-12" id="primary">
      <div class="content">
        <header class="header">
          <hgroup class="pull-left">
            <h1 class="site-title">
              <a href="/">dev@cloudburo</a>
            </h1>
          </hgroup>
          <div class="btn btn-primary pull-right" id="togglesidebar">
            <i class="fa fa-bars"></i>
          </div>
        </header>
        <section class="post">
          <header class="entry-header">
            <h2 class="entry-title">
              <a href="/2016/05/12/the-anatomy-of-a-eb-based-microservice-github-docker-integration.html">The Anatomy of a EB based Microservice - Github Docker Integration</a>
            </h2>
            <p class="entry-meta">
              Posted on  12.May 2016 | Tags <a class="label label-primary" href="/tags/docker.html">docker</a> <a class="label label-primary" href="/tags/architecture.html">architecture</a> <a class="label label-primary" href="/tags/aws.html">aws</a> 
            </p>
          </header>
          <div class="entry-description"><div class="row">
  <div class="article">
    <p><span/>      <div>
        The article describes the fundamental steps for the base setup of the Amazon Elastic Beanstalk Runtime Configuration.
      </div>
      <div>
       <br>
      </div>
      <div>
        For handling S3 based configuration aspects of our Microservices we will setup a bucket, which holds any kind of file required by our Microservices.
      </div>
      <div>
       <br>
      </div>
      <div>
        In order to be fit for grow we will introduce a naming convention from start. An asset/configuration item required for our microservice ecosystem, will start with „
       <span style="">TST</span>“, you should follow a similar strategy in your area. 
      </div>
      <div>
       <strong><br></strong>
      </div>
      <div>
       <span style="font-size: 18px;"><strong>Setup<span style="font-size: 18px;"> </span></strong><strong>up a S3 Bucket for our Microservices</strong></span>
      </div>
      <ul>
       <li>We will call our Amazon S3 Bucket, using <span style="">ms</span> as an acronym for <span style="">microservice</span>.
        <ul>
         <li><span style="">tst.ms.common.&lt;region&gt;</span></li>
         <li>The bucket will hold any data which is common to all our microservices.</li>
        </ul> </li>
       <li>Be aware of that the S3 Bucket must <span style="text-decoration: underline;">be in the same region</span> as your Elastic Beanstalk Instance, therefore we append the region postfix, e.g. <span style="">tst.ms.common.us-west-2.</span></li>
       <li>With the region postfix, we can easily introduce the same bucket in other regions - in case we want to replicate our installations cross-region - following a clean and easy to understand name scheme.</li>
      </ul>
      <div>
       <br>
      </div>
      <div>
       <span style="font-size: 18px;"><strong>Create an IAM Policy for the S3 Bucket Access</strong></span>
      </div>
      <div>
       <strong><br></strong>
      </div>
      <ul>
       <li>We create now an Amazon AWS Identity and Access Management(IAM) Policy, which is a read policy, which will be attached to any of our running microservices:
        <ul>
         <li>IAM Policy: <span style="">TST.S3.Read.clb_ms_common</span></li>
         <li>We will include here any common buckets of the various regions, for now we have only one</li>
        </ul> </li>
      </ul>
      <div>
       <br>
      </div>
      <div></p>
    
  </div>
  <img class="img-responsive img-thumbnail article" src="/images/fa1f9d80fa3e99cfd43cb10f08f2fd30.png" />
  <div class="article">
    <p><span/>        </div>
      <div>
       <br>
      </div>
      <div>
       <span style="font-size: 18px;"><strong>Allocate the policy to your  IAM Role</strong></span>
      </div>
      <div>
       <br>
      </div>
      <div>
        Having defined a read policy, we have to attach now the police to our
       <a href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/concepts-roles.html#concepts-roles-instance">Elastic Beanstalk instance profile</a>.
      </div>
      <div>
       <br>
      </div>
      <div>
        Refer to the following article, 
       <a href="https://dev.cloudburo.net/2015/12/20/the-anatomy-of-a-eb-based-microservice-aws-security-configuration.html">The Anatomy of a EB based Microservice - AWS Security Configuration</a>, which describes how to setup an EB instance profile.
      </div>
      <div>
       <br>
      </div>
      <div>
        We will attach to the role the above created the bucket read policy.
      </div>
      <div>
       <br>
      </div>
      <div></p>
    
  </div>
  <img class="img-responsive img-thumbnail article" src="/images/f1cc61e5c345dcb0403a760325cfe237.png" />
  <div class="article"><p><span/>        </div>
  <div>
   <br>
  </div>
  <div>
    So we have now a common bucket ready in our Elastic Beanstalk region,  which is attached with read-rights to our EB instance configuration.
  </div>
  <div>
   <br>
  </div>
  <div>
    Now head over to your EB project which contains the EB Docker configuration.
  </div>
  <div>
   <br>
  </div>
  <div>
   <br>
  </div>
  <div>
   <span style="font-size: 18px;"><strong>Storing your dockerhub credentials required to access your private Github docker account</strong></span>
  </div>
  <div>
   <br>
  </div>
  <div>
    The common bucket will be used for storing your dockerhub credentials in order to allow EB to pull your private docker image. In case you are working with a public docker image this step is not required.
  </div>
  <div>
   <br>
  </div>
  <ul>
   <li>As a first step store your github credentials in the common bucket, as for example in the file <span style="">tst.ms.common.us-west-2</span>/<span style="">credentials.json</span></li>
  </ul>
  <div>
   <br>
  </div>
  <div></p>
<pre class="highlight json"><code><span class="w">
  </span><span class="p">{</span><span class="w"> 
        </span><span class="s2">"https://index.docker.io/v1/"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> 
                </span><span class="s2">"auth"</span><span class="p">:</span><span class="w"> </span><span class="s2">"myauth1245="</span><span class="p">,</span><span class="w"> 
                </span><span class="s2">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"myemail@gmail.com"</span><span class="w"> 
        </span><span class="p">}</span><span class="w"> 
  </span><span class="p">}</span><span class="w"> 

</span></code></pre>

<div>
   <br>
  </div>

<p><ul>
   <li>You docker sensitive access data is now available to EB in a encrypted manner and secured at rest.</li>
  </ul>
  <div>
   <br>
  </div>
  <div>
   <b><span style="font-size: 18px;">Configure the docker file in your Elastic Beanstalk Directory</span></b>
  </div>
  <div>
   <br>
  </div>
  <ul>
   <li>Add the following entry to your <span style="">Dockerrun.aws.json. </span>The file describes your <a href="http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker_image.html">EB single container docker configuration</a> and the entry will tell EB where to find your authentication information to access your private docker hub repository.</li>
  </ul>
  <div>
   <br>
  </div>
  <div></p>
<pre class="highlight plaintext"><code>
    "Authentication": { 
      "Bucket": "clb.ms.common.us-west-2", 
      "Key": "credentials.json" 
    }, 

</code></pre>

<div>
   <br>
  </div>

<p><ul>
   <li>Finally add an entry where to find the docker image to the <span style="">Dockerrun.aws.json</span> file</li>
  </ul>
  <div>
   <br>
  </div>
  <div></p>
<pre class="highlight plaintext"><code>
    "Image": { 
      "Name": „&lt;dockerhubUsername&gt;/curationplatform:v1.0.2", 
      "Update": "true" 
    }, 

</code></pre>

<div>
   <br>
  </div>

<p><ul>
   <li>The overall Dockerrun.aws.json file will look like as following and EB will load your application from a private dockerhub repository.</li>
  </ul>
  <div>
   <br>
  </div>
  <div></p>
<pre class="highlight json"><code><span class="w">
  </span><span class="p">{</span><span class="w"> 
    </span><span class="s2">"AWSEBDockerrunVersion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w"> 
    </span><span class="s2">"Authentication"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> 
      </span><span class="s2">"Bucket"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tst.ms.common.us-west-2"</span><span class="p">,</span><span class="w"> 
      </span><span class="s2">"Key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"credentials.json"</span><span class="w"> 
    </span><span class="p">},</span><span class="w"> 
    </span><span class="s2">"Image"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> 
      </span><span class="s2">"Name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dockerhubusername/curationplatform:v1.0.2"</span><span class="p">,</span><span class="w"> 
      </span><span class="s2">"Update"</span><span class="p">:</span><span class="w"> </span><span class="s2">"false"</span><span class="w"> 
    </span><span class="p">},</span><span class="w"> 
    </span><span class="s2">"Volumes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> 
      </span><span class="p">{</span><span class="w"> 
        </span><span class="s2">"HostDirectory"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/var/log"</span><span class="p">,</span><span class="w"> 
        </span><span class="s2">"ContainerDirectory"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/home/app/log"</span><span class="w"> 
      </span><span class="p">}</span><span class="w"> 
    </span><span class="p">],</span><span class="w"> 
    </span><span class="s2">"Ports"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> 
       </span><span class="p">{</span><span class="w"> 
         </span><span class="s2">"ContainerPort"</span><span class="p">:</span><span class="w"> </span><span class="s2">"80"</span><span class="w"> 
       </span><span class="p">}</span><span class="w"> 
     </span><span class="p">],</span><span class="w"> 
    </span><span class="s2">"Logging"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/var/log/docker.log"</span><span class="w"> 
  </span><span class="p">}</span><span class="w"> 

</span></code></pre>

<p></div>
  <div>
   <br>
  </div></p>

  </div>
</div>
          </div>
          <div class="comments">
            <div id="disqus_thread">
              <div id="disqus_thread"></div>
              <script type="text/javascript">
              //<![CDATA[
                                var disqus_shortname = 'dev1cloudburo';
                        
                  (function() {
                      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                  })();
              //]]>
              </script>
              <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
              <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
              
              <script type="text/javascript">
              //<![CDATA[
                  var disqus_shortname = 'dev1cloudburo';
                  (function () {
                      var s = document.createElement('script'); s.async = true;
                      s.type = 'text/javascript';
                      s.src = '//' + disqus_shortname + '.disqus.com/count.js';
                      (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
                  }());
              //]]>
              </script>
              
            </div>
          </div>
        </section><footer class="footer">
          <p>
          </p>
          <div class="socials-footer"><a href="https://twitter.com/talfco" class="btn btn-twitter">
                <i class="fa fa-twitter"></i></a><a href="https://www.linkedin.com/in/felixk" class="btn btn-linkedin">
                <i class="fa fa-linkedin"></i></a><a href="https://github.com/talfco" class="btn btn-github">
                <i class="fa fa-github"></i></a>
          </div>
          <p>
            © 2020 All rights reserved 
          </p>
        </footer>
      </div>
    </div>
    <script src="../../../js/all.js"></script>
  </body>
</html>