<!doctype html> 
<html>
  <head>
    <meta charset="utf-8" />
    <meta content="IE=edge;chrome=1" http-equiv="X-UA-Compatible" />
    <title>dev@cloudburo | Meteor Small Hints #4: Reading this.params values in the iron-router Data Context</title>
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" /><!--[if lt IE 9]><script src="../../../js/ie8.js" type="text/javascript"></script><![endif]--><link href="../../../css/all.css" media="screen" rel="stylesheet" type="text/css" /><script type="text/javascript">
      (function(d,e,j,h,f,c,b){d.GoogleAnalyticsObject=f;d[f]=d[f]||function(){(d[f].q=d[f].q||[]).push(arguments)},d[f].l=1*new Date();c=e.createElement(j),b=e.getElementsByTagName(j)[0];c.async=1;c.src=h;b.parentNode.insertBefore(c,b)})(window,document,"script","//www.google-analytics.com/analytics.js","ga");ga("create","UA-35696879-1", location.hostname);ga("send","pageview");
    </script>
    <link href="/favicon.png" rel="icon" type="image/png" />
  </head>
  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button class="navbar-toggle collapsed" data-target=".navbar-ex1-collapse" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/">dev@cloudburo</a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
          <ul class="nav navbar-nav">
            <li>
              <a href="/menu1.html"> About  </a>
            </li>
            <li>
              <a href="/menu2.html"> Contact  </a>
            </li>
            <li class="dropdown">
              <a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">Categories <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                <li>
                  <a href="/tags/api.html">api (2)</a>
                </li>
                <li>
                  <a href="/tags/architecture.html">architecture (10)</a>
                </li>
                <li>
                  <a href="/tags/aws.html">aws (10)</a>
                </li>
                <li>
                  <a href="/tags/banking.html">banking (1)</a>
                </li>
                <li>
                  <a href="/tags/bootstrap.html">bootstrap (1)</a>
                </li>
                <li>
                  <a href="/tags/deutsch.html">deutsch (1)</a>
                </li>
                <li>
                  <a href="/tags/docker.html">docker (9)</a>
                </li>
                <li>
                  <a href="/tags/futurework.html">futureWork (5)</a>
                </li>
                <li>
                  <a href="/tags/googleapps.html">googleapps (1)</a>
                </li>
                <li>
                  <a href="/tags/gradle.html">gradle (2)</a>
                </li>
                <li>
                  <a href="/tags/grails.html">grails (2)</a>
                </li>
                <li>
                  <a href="/tags/inspiration.html">inspiration (2)</a>
                </li>
                <li>
                  <a href="/tags/legal.html">legal (1)</a>
                </li>
                <li>
                  <a href="/tags/meteor.html">meteor (4)</a>
                </li>
                <li>
                  <a href="/tags/microservice.html">microservice (12)</a>
                </li>
                <li>
                  <a href="/tags/modeling.html">modeling (1)</a>
                </li>
                <li>
                  <a href="/tags/personaldata.html">personalData (2)</a>
                </li>
                <li>
                  <a href="/tags/quicktips.html">quicktips (12)</a>
                </li>
                <li>
                  <a href="/tags/shift.html">shift (4)</a>
                </li>
                <li>
                  <a href="/tags/smallhints.html">smallhints (14)</a>
                </li>
                <li>
                  <a href="/tags/startup.html">startup (9)</a>
                </li>
              </ul>
            </li>
            <li class="dropdown">
              <a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">By Year <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                <li>
                  <a href="/2016.html">2016 (6)</a>
                </li>
                <li>
                  <a href="/2015.html">2015 (37)</a>
                </li>
                <li>
                  <a href="/2014.html">2014 (10)</a>
                </li>
              </ul>
            </li>
            <ul class="list-unstyled list-inline nav navbar-nav navbar-right"></ul>
            <li><a href="https://twitter.com/talfco">
                        <i class="fa fa-lg fa-inverse fa-twitter-square"></i></a>
            </li>
            <li><a href="https://plus.google.com/u/1/b/102868953630532463137/+CloudburoCh/posts">
                        <i class="fa fa-lg fa-inverse fa-google-plus-square"></i></a>
            </li>
            <li><a href="https://www.linkedin.com/in/felixk">
                        <i class="fa fa-lg fa-inverse fa-linkedin-square"></i></a>
            </li>
            <li><a href="https://github.com/talfco">
                        <i class="fa fa-lg fa-inverse fa-github-square"></i></a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <div class="container">
      <div class="row">
        <div class="col-lg-9 col-md-9">
          <h1>
            Meteor Small Hints #4: Reading this.params values in the iron-router Data Context
          </h1>
          <small class="label label-default">smallhints</small>
          <small class="label label-default">meteor</small>
          <hr />
          <p>
            <span class="glyphicon glyphicon-time"></span> Posted on May 23
          </p>
          <hr /><div class="row">
  <div class="article"><p><span/>      <div>
   <a href="http://iron-meteor.github.io/iron-router">Iron-router</a> is a powerful Meteor router that works on the server and browser. 
  </div>
  <div>
   <br>
  </div>
  <div>
    In this article we describe how you can read out a query parameter via the data context of the iron-router, which then can be processed later in the  template. In the below example we have outsourced the routing logic for
   <i>/dashboard</i> to an iron-router controller file.
  </div>
  <div>
   <br>
  </div>
  <div></p>
<pre class="highlight coffeescript"><code>
  <span class="nx">Router</span><span class="p">.</span><span class="na">route</span> <span class="s">'/dashboard'</span><span class="p">,</span> <span class="na">name</span><span class="o">:</span> <span class="s">"dashboard"</span><span class="p">,</span> <span class="na">controller</span><span class="o">:</span> <span class="s">'DashboardController'</span> 

</code></pre>

<div>
   <br>
  </div>

<p><div>
    In the URL call we will pass in a query parameter, e.g.
   <a href="https://bots.cloudburo.net/dashboard?regCode=%E2%80%9CT@myProductName"><a href="https://bots.cloudburo.net/dashboard?regCode=%E2%80%9CT@myProductName">https://bots.cloudburo.net/dashboard?regCode=â€œT@myProductName</a></a>
  </div>
  <div>
   <br>
  </div>
  <div>
    Now in order to retrieve this query parameter - via the
   <i>this.params</i> object - in the iron-router data context,
   <u><b>you have to use for the data assignment a function</b></u>
   <i>.</i>  Trying it without a function call the this.params will not be returned. This took m quite some time to figure out, I always tried it with direct assignment in the data section.
  </div>
  <div>
   <br>
  </div>
  <div></p>
<pre class="highlight coffeescript"><code>
  <span class="nx">exports</span><span class="p">.</span><span class="na">DashboardController</span> <span class="o">=</span> <span class="nx">AppController</span><span class="p">.</span><span class="na">extend</span> 


    <span class="na">waitOn</span><span class="o">:</span> <span class="p">()</span> <span class="o">-&gt;</span> 
      <span class="k">this</span><span class="p">.</span><span class="na">subscribe</span> <span class="s">'userData'</span> 
      <span class="k">this</span><span class="p">.</span><span class="na">subscribe</span> <span class="s">'productTypes'</span> 
      <span class="k">this</span><span class="p">.</span><span class="na">subscribe</span> <span class="s">'products'</span> 
      <span class="k">this</span><span class="p">.</span><span class="na">subscribe</span> <span class="s">'productAdmins'</span> 


    <span class="c1"># Use a function to allocate the data context, when you require this.params values 
</span>    <span class="na">data</span><span class="o">:</span> <span class="p">()</span> <span class="o">-&gt;</span> 
      <span class="k">if</span> <span class="k">this</span><span class="p">.</span><span class="na">params</span><span class="o">?</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="na">params</span><span class="p">.</span><span class="na">query</span><span class="o">?</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="na">params</span><span class="p">.</span><span class="na">query</span><span class="p">.</span><span class="na">regCode</span><span class="o">?</span> 
        <span class="nx">Plattform</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="s">"Dashboard Controller called with "</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="na">params</span><span class="p">.</span><span class="na">query</span><span class="p">.</span><span class="na">regCode</span><span class="p">)</span> 
        <span class="nx">regC</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">params</span><span class="p">.</span><span class="na">query</span><span class="p">.</span><span class="na">regCode</span> 
      <span class="k">else</span> 
        <span class="nx">regC</span> <span class="o">=</span> <span class="no">undefined</span> 
      <span class="nx">templateData</span> <span class="o">=</span> 
        <span class="na">productTypes</span><span class="o">:</span> <span class="nx">ProductTypes</span><span class="p">.</span><span class="na">find</span><span class="p">()</span> 
        <span class="na">productAdmins</span><span class="o">:</span> <span class="nx">ProductAdmins</span><span class="p">.</span><span class="na">find</span><span class="p">()</span> 
        <span class="na">currencySymbol</span><span class="o">:</span> <span class="nx">Plattform</span><span class="p">.</span><span class="na">getCurrencySymbol</span><span class="p">()</span> 
        <span class="na">products</span><span class="o">:</span> <span class="nx">Products</span><span class="p">.</span><span class="na">find</span><span class="p">({})</span> 
        <span class="na">regCode</span> <span class="o">:</span> <span class="nx">regC</span> 
      <span class="k">return</span> <span class="nx">templateData</span> 

</code></pre>

<div>
   <br>
  </div>

<p><div>
    In the template itself I can reference directly the
   <i>regCode</i> value
  </div>
  <div>
   <br>
  </div>
  <div></p>
<pre class="highlight coffeescript"><code>
  <span class="nx">Template</span><span class="p">.</span><span class="na">dashboard</span><span class="p">.</span><span class="na">rendered</span> <span class="o">=</span> <span class="p">()</span> <span class="o">-&gt;</span> 
      <span class="nx">Plattform</span><span class="p">.</span><span class="na">debug</span> <span class="s">"Template.dashboard.rendered"</span> 
      <span class="nx">$</span><span class="p">(</span><span class="s">'.statusicon'</span><span class="p">).</span><span class="na">tooltip</span><span class="p">();</span> 
      <span class="k">if</span> <span class="k">this</span><span class="p">.</span><span class="na">data</span><span class="p">.</span><span class="na">regCode</span><span class="o">?</span> 
        <span class="k">if</span> <span class="nx">Products</span><span class="p">.</span><span class="na">find</span><span class="p">().</span><span class="na">fetch</span><span class="p">().</span><span class="na">length</span> <span class="o">==</span> <span class="mi">0</span> 
          <span class="nx">Plattform</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="s">"A new client from subscriber page - regCode: "</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="na">data</span><span class="p">.</span><span class="na">regCode</span><span class="p">)</span> 
          <span class="nx">splits</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">data</span><span class="p">.</span><span class="na">regCode</span><span class="p">.</span><span class="na">split</span><span class="p">(</span><span class="s">"@"</span><span class="p">)</span> 
          <span class="k">if</span> <span class="nx">splits</span><span class="p">.</span><span class="na">length</span>  <span class="o">==</span> <span class="mi">2</span> 
            <span class="nx">productType</span> <span class="o">=</span> <span class="nx">ProductTypes</span><span class="p">.</span><span class="na">findOne</span><span class="p">(</span><span class="na">name</span><span class="o">:</span> <span class="nx">splits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> 
            <span class="k">if</span> <span class="nx">productType</span><span class="o">?</span> 
              <span class="k">if</span> <span class="nx">splits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">"T"</span> 
                <span class="nx">testProduct</span> <span class="nx">productType</span><span class="p">.</span><span class="na">_id</span> 
              <span class="k">else</span> <span class="k">if</span> <span class="nx">splits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">"S"</span> 
                <span class="nx">buyProduct</span> <span class="nx">productType</span><span class="p">.</span><span class="na">_id</span> 

</code></pre>

<p></div>
  <div>
   <br>
  </div>
  <div>
   <span style="font-size: 11px;"><i>This blog entry was fully produced within Evernote and published using the <a href="https://publishingbot.cloudburo.net">Cloudburo Publishing Bot</a>.</i></span>
  </div></p>

  </div>
</div>
          <hr />
          <div id="disqus_thread"></div>
          <script type="text/javascript">
          //<![CDATA[
                            var disqus_shortname = 'dev1cloudburo';
                    
              (function() {
                  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
              })();
          //]]>
          </script>
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
          <script type="text/javascript">
          //<![CDATA[
              var disqus_shortname = 'dev1cloudburo';
              (function () {
                  var s = document.createElement('script'); s.async = true;
                  s.type = 'text/javascript';
                  s.src = '//' + disqus_shortname + '.disqus.com/count.js';
                  (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
              }());
          //]]>
          </script>
          
          <aside>
            <h3>
              Recent Articles
            </h3>
            <ol>
              <li>
                <a href="/2016/05/23/meteor-small-hints-4-reading-this-params-values-in-the-iron-router-data-context.html">Meteor Small Hints #4: Reading this.params values in the iron-router Data Context</a> <span>May 23</span> 
              </li>
              <li>
                <a href="/2016/05/13/how-we-built-an-ecommerce-business-from-scratch-and-generated-922-16-in-revenue-.html">How We Built an Ecommerce Business from Scratch and Generated $922.16 in Revenue in 3 Days</a> <span>May 13</span> 
              </li>
              <li>
                <a href="/2016/05/12/the-anatomy-of-a-eb-based-microservice-github-docker-integration.html">The Anatomy of a EB based Microservice - Github Docker Integration</a> <span>May 12</span> 
              </li>
              <li>
                <a href="/2016/04/24/meteor-small-hints-3-passing-query-parameters-to-signup-route.html">Meteor Small Hints #3: Passing Query Parameters to Signup Route</a> <span>Apr 24</span> 
              </li>
              <li>
                <a href="/2016/04/21/meteor-small-hints-2-calling-local-methods-in-a-template.html">Meteor Small Hints #2: Calling local methods in a Template</a> <span>Apr 21</span> 
              </li>
              <li>
                <a href="/2016/03/04/rodrigue-schaefer-from-monolith-to-microservices-at-zalando.html">Rodrigue Schaefer : From monolith to microservices at Zalando</a> <span>Mar  4</span> 
              </li>
              <li>
                <a href="/2015/12/20/the-anatomy-of-a-eb-based-microservice-aws-security-configuration.html">The Anatomy of a EB based Microservice - AWS Security Configuration</a> <span>Dec 20</span> 
              </li>
              <li>
                <a href="/2015/11/15/problems-with-aws-cli-on-mac-osx-el-capitan.html">Problems with AWS CLI on Mac OSX El Capitan</a> <span>Nov 15</span> 
              </li>
              <li>
                <a href="/2015/11/07/dmarc-how-to-monitor-and-secure-your-email.html">DMARC: How to monitor and secure your email</a> <span>Nov  7</span> 
              </li>
              <li>
                <a href="/2015/10/03/meteor-small-hints-1-execute-a-function-by-name-which-works-on-client-and-server.html">Meteor Small Hints #1: Execute a function by name which works on client and server</a> <span>Oct  3</span> 
              </li>
            </ol>
          </aside>
          <hr>
            <p class="text-center">
              Â©2016 <a href="/">dev@cloudburo</a> <br /><span class="small">Powered by<a href="https://cloudburo.net/docs/products.html"> Cloudburo Curation Engine</a></span>
            </p>
          </hr>
        </div>
        <div class="col-lg-3 col-md-3">
          <div class="well">
            <h4>
              Categories
            </h4>
            <ul class="list-unstyled">
              <li>
                <a href="/tags/api.html">api</a> (2)
              </li>
              <li>
                <a href="/tags/architecture.html">architecture</a> (10)
              </li>
              <li>
                <a href="/tags/aws.html">aws</a> (10)
              </li>
              <li>
                <a href="/tags/banking.html">banking</a> (1)
              </li>
              <li>
                <a href="/tags/bootstrap.html">bootstrap</a> (1)
              </li>
              <li>
                <a href="/tags/deutsch.html">deutsch</a> (1)
              </li>
              <li>
                <a href="/tags/docker.html">docker</a> (9)
              </li>
              <li>
                <a href="/tags/futurework.html">futureWork</a> (5)
              </li>
              <li>
                <a href="/tags/googleapps.html">googleapps</a> (1)
              </li>
              <li>
                <a href="/tags/gradle.html">gradle</a> (2)
              </li>
              <li>
                <a href="/tags/grails.html">grails</a> (2)
              </li>
              <li>
                <a href="/tags/inspiration.html">inspiration</a> (2)
              </li>
              <li>
                <a href="/tags/legal.html">legal</a> (1)
              </li>
              <li>
                <a href="/tags/meteor.html">meteor</a> (4)
              </li>
              <li>
                <a href="/tags/microservice.html">microservice</a> (12)
              </li>
              <li>
                <a href="/tags/modeling.html">modeling</a> (1)
              </li>
              <li>
                <a href="/tags/personaldata.html">personalData</a> (2)
              </li>
              <li>
                <a href="/tags/quicktips.html">quicktips</a> (12)
              </li>
              <li>
                <a href="/tags/shift.html">shift</a> (4)
              </li>
              <li>
                <a href="/tags/smallhints.html">smallhints</a> (14)
              </li>
              <li>
                <a href="/tags/startup.html">startup</a> (9)
              </li>
            </ul>
          </div>
          <div class="well">
            <h4>
              By year
            </h4>
            <ol>
              <li>
                <a href="/2016.html">2016</a> (6)
              </li>
              <li>
                <a href="/2015.html">2015</a> (37)
              </li>
              <li>
                <a href="/2014.html">2014</a> (10)
              </li>
            </ol>
          </div>
        </div>
      </div>
    </div>
    <script src="../../../js/all.js" type="text/javascript"></script>
  </body>
</html>