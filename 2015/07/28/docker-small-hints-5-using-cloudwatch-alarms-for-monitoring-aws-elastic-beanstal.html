<!doctype html> 
<html>
  <head>
    <meta charset="utf-8" />
    <meta content="IE=edge;chrome=1" http-equiv="X-UA-Compatible" />
    <title>dev@cloudburo | Docker Small Hints #5: Using Cloudwatch Alarms for monitoring AWS Elastic Beanstalk Docker Instances</title>
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" /><!--[if lt IE 9]><script src="../../../js/ie8.js" type="text/javascript"></script><![endif]--><link href="../../../css/all.css" media="screen" rel="stylesheet" type="text/css" /><script type="text/javascript">
      (function(d,e,j,h,f,c,b){d.GoogleAnalyticsObject=f;d[f]=d[f]||function(){(d[f].q=d[f].q||[]).push(arguments)},d[f].l=1*new Date();c=e.createElement(j),b=e.getElementsByTagName(j)[0];c.async=1;c.src=h;b.parentNode.insertBefore(c,b)})(window,document,"script","//www.google-analytics.com/analytics.js","ga");ga("create","UA-35696879-1", location.hostname);ga("send","pageview");
    </script>
    <link href="/favicon.png" rel="icon" type="image/png" />
  </head>
  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button class="navbar-toggle collapsed" data-target=".navbar-ex1-collapse" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/">dev@cloudburo</a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
          <ul class="nav navbar-nav">
            <li>
              <a href="/menu1.html"> About  </a>
            </li>
            <li>
              <a href="/menu2.html"> Contact  </a>
            </li>
            <li class="dropdown">
              <a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">Categories <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                <li>
                  <a href="/tags/api.html">api (2)</a>
                </li>
                <li>
                  <a href="/tags/architecture.html">architecture (9)</a>
                </li>
                <li>
                  <a href="/tags/aws.html">aws (9)</a>
                </li>
                <li>
                  <a href="/tags/banking.html">banking (1)</a>
                </li>
                <li>
                  <a href="/tags/bootstrap.html">bootstrap (1)</a>
                </li>
                <li>
                  <a href="/tags/deutsch.html">deutsch (1)</a>
                </li>
                <li>
                  <a href="/tags/docker.html">docker (8)</a>
                </li>
                <li>
                  <a href="/tags/futurework.html">futureWork (5)</a>
                </li>
                <li>
                  <a href="/tags/googleapps.html">googleapps (1)</a>
                </li>
                <li>
                  <a href="/tags/gradle.html">gradle (2)</a>
                </li>
                <li>
                  <a href="/tags/grails.html">grails (2)</a>
                </li>
                <li>
                  <a href="/tags/inspiration.html">inspiration (2)</a>
                </li>
                <li>
                  <a href="/tags/legal.html">legal (1)</a>
                </li>
                <li>
                  <a href="/tags/meteor.html">meteor (3)</a>
                </li>
                <li>
                  <a href="/tags/microservice.html">microservice (12)</a>
                </li>
                <li>
                  <a href="/tags/modeling.html">modeling (1)</a>
                </li>
                <li>
                  <a href="/tags/personaldata.html">personalData (2)</a>
                </li>
                <li>
                  <a href="/tags/quicktips.html">quicktips (12)</a>
                </li>
                <li>
                  <a href="/tags/shift.html">shift (4)</a>
                </li>
                <li>
                  <a href="/tags/smallhints.html">smallhints (13)</a>
                </li>
                <li>
                  <a href="/tags/startup.html">startup (8)</a>
                </li>
              </ul>
            </li>
            <li class="dropdown">
              <a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">By Year <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                <li>
                  <a href="/2016.html">2016 (3)</a>
                </li>
                <li>
                  <a href="/2015.html">2015 (37)</a>
                </li>
                <li>
                  <a href="/2014.html">2014 (10)</a>
                </li>
              </ul>
            </li>
            <ul class="list-unstyled list-inline nav navbar-nav navbar-right"></ul>
            <li><a href="https://twitter.com/talfco">
                        <i class="fa fa-lg fa-inverse fa-twitter-square"></i></a>
            </li>
            <li><a href="https://plus.google.com/u/1/b/102868953630532463137/+CloudburoCh/posts">
                        <i class="fa fa-lg fa-inverse fa-google-plus-square"></i></a>
            </li>
            <li><a href="https://www.linkedin.com/in/felixk">
                        <i class="fa fa-lg fa-inverse fa-linkedin-square"></i></a>
            </li>
            <li><a href="https://github.com/talfco">
                        <i class="fa fa-lg fa-inverse fa-github-square"></i></a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <div class="container">
      <div class="row">
        <div class="col-lg-9 col-md-9">
          <h1>
            Docker Small Hints #5: Using Cloudwatch Alarms for monitoring AWS Elastic Beanstalk Docker Instances
          </h1>
          <small class="label label-default">microservice</small>
          <small class="label label-default">aws</small>
          <small class="label label-default">quicktips</small>
          <hr />
          <p>
            <span class="glyphicon glyphicon-time"></span> Posted on Jul 28
          </p>
          <hr />
          <div class="row">
            <div class="article">
              <p><span/></p>
              
              <p><div>
                  My first docker based 
                 <a href="https://curation.cloudburo.net/">content curation microservice</a> is in early beta mode and is working reliably for a longer period of time now. The last deployment of the application was up and running for 46 days without any major operational incident. 
                </div> 
                <div> 
                 <br> 
                </div> 
                <div>
                  Suddenly the Micro-service stopped to generate blog entries out of Evernote Notes. I wasn’t monitoring this constellation up until now and detected it just about 4 hours later. Not very good when you want to go live. 
                </div> 
                <div> 
                 <br> 
                </div> 
                <div>
                  So time to start monitoring such kind of incidents by using  CloudWatch and start sending out alarm emails in order to be capable to keep the service live all the time. 
                </div> 
                <div> 
                 <br> 
                </div> 
                <div>
                  Elastic Beanstalk automatically uses<br>
                 <a href="http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/AWSHowTo.cloudwatch.html">Amazon CloudWatch</a> to help you  monitor your application and environment status.  The Amazon CloudWatch console gives you an overview of all of your resources as well as your alarms.<br>
                </div> 
                <div> 
                 <br> 
                </div> 
                <div></p>
              
            </div>
            <img class="img-responsive img-thumbnail article" src="/images/c4254846da654fcf8f562b647a640a54.png" />
            <div class="article">
              <p><span/> 
                </div> 
                <div> 
                 <br> 
                </div> 
                <div>
                  In order to handle this new kind of incidents it’s necessary to create a new alarm which detects the pattern, but &hellip; 
                </div> 
                <div> 
                 <br> 
                </div> 
                <div>
                  … first the root cause analysis must be done, what the heck stopped to work as expected. 
                </div> 
                <div> 
                 <br> 
                </div> 
                <div>
                  My primary monitoring application for the java based micro service is 
                 <a href="https://logentries.com/">logentries.com</a>. The java/groovy application on the EB Docker instance will send various kind of log information (via log4j  to the logentries log management and analytics application). 
                </div> 
                <div> 
                 <br> 
                </div> 
                <div>
                  As one can see in the below 24 hours log, everthing seems find up around 10:00 where no micro service log entries were shown anymore. 
                </div> 
                <div> 
                 <br> 
                </div> 
                <div></p>
              
            </div>
            <img class="img-responsive img-thumbnail article" src="/images/ad9e91d21c0ec36e7aa2f399178f089a.png" />
            <div class="article">
              <p><span/> 
                </div> 
                <div> 
                 <br> 
                </div> 
                <div>
                  That means something stopped working on the Amazon Docker instance, which wasn’t detected by AWS EB manager itself. E.g. in case my Microservice App would memory leaked over time and crash at one time, the AWS EB manager would detect that an restart the microservice automatically  (making the application available again after some minutes). Such an incident wouldn’t result in the above pattern. 
                </div> 
                <div> 
                 <br> 
                </div> 
                <div>
                  So I had to go on and check the AWS EB Docker instance logs directly (refer to the 
                 <a href="https://dev.cloudburo.net/2015/04/25/docker-small-hints-3-ssh-into-your-aws-elastic-beanstalk-component.html">following article</a> how to achieve that).  A first glance  showed me that the java based microservice application was still running (on top of the list, consuming the major part of the memory). No restart or anything else happened, uptime was 46 days. 
                </div> 
                <div> 
                 <br> 
                </div> 
                <div></p>
              
            </div>
            <img class="img-responsive img-thumbnail article" src="/images/71b4a9fbe17004641f16073d2c17628a.png" />
            <div class="article">
              <p><span/> 
                </div> 
                <div> 
                 <br> 
                </div> 
                <div>
                  So let’s check then the application log of the eb docker container, which can be found in the /var/log/… directory. 
                </div> 
                <div> 
                 <br> 
                </div> 
                <div></p>
              
            </div>
            <img class="img-responsive img-thumbnail article" src="/images/5dc5c78335f67a3340f824951697f0e4.png" />
            <div class="article">
              <p><span/> 
                </div> 
                <div> 
                 <br> 
                </div> 
                <div>
                  Counter checking with the last message received by logentries, it lead to the conclusion, that the local log is in sync with the logentries remote one. So the java process stopped working at that point in time and wasn’t producing any log events anymore. So we have to establish a monitoring strategy which is capable of identifying our hanging micro service process. 
                </div> 
                <div> 
                 <br> 
                </div> 
                <div>
                  Time to define an AWS Cloudwatch Alert which will allows me to detect this inactivity/hanging process behavior. 
                </div> 
                <div> 
                 <br> 
                </div> 
                <div>
                  Looking at the EB Monitoring in the Dashboard shows me that such an incident would result in &ldquo;Max Network In“ flow of a small amount of KB’s (refer to the 
                 <a href="https://dev.cloudburo.net/2015/04/09/docker-small-hints-1-high-level-concepts-elastic-beanstalk.html">following article</a> to understand the high level EB concepts). This seems to be the strongest signal for such a behaviour. Using the low CPU Utilization as a signal, seems not advisable, due to the fact that this threshold could shift in case of auto scaling scenarios. 
                </div> 
                <div></p>
              
            </div>
            <img class="img-responsive img-thumbnail article" src="/images/8bd6de153b5e793c550b2185ba7f8d94.png" />
            <div class="article">
              <p><span/> 
                </div> 
                <div> 
                 <br> 
                </div> 
                <div>
                  Just to be sure I checked  the graph over a two weeks period of time. It shows me that this seems a good signal for a hanging microservice java process. 
                </div> 
                <div> 
                 <br> 
                </div> 
                <div></p>
              
            </div>
            <img class="img-responsive img-thumbnail article" src="/images/813200dfe04e9b01b5d13837ee10ca7f.png" />
            <div class="article">
              <p><span/> 
                </div> 
                <div> 
                 <br> 
                </div> 
                <div>
                  Now let’s create an Alarm then, which is straightforward and easy and can be done on the EB Monitoring site directly. 
                </div> 
                <div> 
                 <br> 
                </div> 
                <div></p>
              
            </div>
            <img class="img-responsive img-thumbnail article" src="/images/0f96def25c50580998ff55218391d961.png" />
            <div class="article">
              <p><span/> 
                </div> 
                <div> 
                 <br> 
                </div> 
                <div>
                  Let’s go back to the Dashboard to see if the Alarm is, correctly shown. Yes it got triggered. 
                </div> 
                <div> 
                 <br> 
                </div> 
                <div></p>
              
            </div>
            <img class="img-responsive img-thumbnail article" src="/images/e63d6ee6edc3c73364addaae60b2cffb.png" />
            <div class="article">
              <p><span/> 
                </div> 
                <div> 
                 <br> 
                </div> 
                <div>
                  The Alarm Dashboard shows the existing Alarm, very nice. It will be also visible on the Cloudwatch Dashboard site. 
                </div> 
                <div> 
                 <br> 
                </div> 
                <div></p>
              
            </div>
            <img class="img-responsive img-thumbnail article" src="/images/4a88ab998c68e7eee4fbe76c2c0a418d.png" />
            <div class="article">
              <p><span/> 
                </div> 
                <div>
                  I also get notified via Email by the AWS Notification service to subscribe for the topic.<br>
                </div> 
                <div> 
                 <br> 
                </div> 
                <div></p>
              
            </div>
            <img class="img-responsive img-thumbnail article" src="/images/513a3b55b0b3186a6c20103e82000aa9.png" />
            <div class="article">
              <p><span/> 
                </div> 
                <div>
                  Having done that I will now receive an email when my microservice is hanging or inactive for more than some minutes. It allows me to timely restart or investigate the problem which results in a better service level for my clients. 
                </div> 
                <div> 
                 <br> 
                </div> 
                <div>
                  In a next article I will investigate in the possibilities to automate the creation of CloudWatch Alarms during my EB Environment creation step. 
                </div> 
                <div> 
                 <br> 
                </div> 
                <div></p>
              
            </div>
            <img class="img-responsive img-thumbnail article" src="/images/3c1663d43864486db5b237ca1a1546e0.png" />
            <div class="article">
              <p><span/> 
                </div> 
                <div> 
                 <br> 
                </div> 
                <div> 
                 <br> 
                </div></p>
              
            </div>
          </div>
          <hr />
          <div id="disqus_thread"></div>
          <script type="text/javascript">
          //<![CDATA[
                            var disqus_shortname = 'dev1cloudburo';
                    
              (function() {
                  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
              })();
          //]]>
          </script>
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
          <script type="text/javascript">
          //<![CDATA[
              var disqus_shortname = 'dev1cloudburo';
              (function () {
                  var s = document.createElement('script'); s.async = true;
                  s.type = 'text/javascript';
                  s.src = '//' + disqus_shortname + '.disqus.com/count.js';
                  (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
              }());
          //]]>
          </script>
          
          <aside>
            <h3>
              Recent Articles
            </h3>
            <ol>
              <li>
                <a href="/2016/04/24/meteor-small-hints-3-passing-query-parameters-to-signup-route.html">Meteor Small Hints #3: Passing Query Parameters to Signup Route</a> <span>Apr 24</span> 
              </li>
              <li>
                <a href="/2016/04/21/meteor-small-hints-2-calling-local-methods-in-a-template.html">Meteor Small Hints #2: Calling local methods in a Template</a> <span>Apr 21</span> 
              </li>
              <li>
                <a href="/2016/03/04/rodrigue-schaefer-from-monolith-to-microservices-at-zalando.html">Rodrigue Schaefer : From monolith to microservices at Zalando</a> <span>Mar  4</span> 
              </li>
              <li>
                <a href="/2015/12/20/the-anatomy-of-a-eb-based-microservice-aws-security-configuration.html">The Anatomy of a EB based Microservice - AWS Security Configuration</a> <span>Dec 20</span> 
              </li>
              <li>
                <a href="/2015/11/15/problems-with-aws-cli-on-mac-osx-el-capitan.html">Problems with AWS CLI on Mac OSX El Capitan</a> <span>Nov 15</span> 
              </li>
              <li>
                <a href="/2015/11/07/dmarc-how-to-monitor-and-secure-your-email.html">DMARC: How to monitor and secure your email</a> <span>Nov  7</span> 
              </li>
              <li>
                <a href="/2015/10/03/meteor-small-hints-1-execute-a-function-by-name-which-works-on-client-and-server.html">Meteor Small Hints #1: Execute a function by name which works on client and server</a> <span>Oct  3</span> 
              </li>
              <li>
                <a href="/2015/10/01/micro-business-quick-tips-6-the-business-model-canvas-playground-for-free.html">Micro-Business Quick Tips #6 - The Business Model Canvas Playground for Free</a> <span>Oct  1</span> 
              </li>
              <li>
                <a href="/2015/10/01/micro-business-quick-tips-5-using-product-canvas-to-create-and-define-new-produc.html">Micro-Business Quick Tips #5 - Using Product Canvas to create and define new Products</a> <span>Oct  1</span> 
              </li>
              <li>
                <a href="/2015/09/30/micro-business-quick-tips-4-visualizing-your-business-model-with-canvas.html">Micro Business Quick Tips #4: Visualizing your Business Model with Canvas</a> <span>Sep 30</span> 
              </li>
            </ol>
          </aside>
          <hr>
            <p class="text-center">
              ©2016 <a href="/">dev@cloudburo</a> <br /><span class="small">Powered by<a href="https://cloudburo.net/docs/products.html"> Cloudburo Curation Engine</a></span>
            </p>
          </hr>
        </div>
        <div class="col-lg-3 col-md-3">
          <div class="well">
            <h4>
              Categories
            </h4>
            <ul class="list-unstyled">
              <li>
                <a href="/tags/api.html">api</a> (2)
              </li>
              <li>
                <a href="/tags/architecture.html">architecture</a> (9)
              </li>
              <li>
                <a href="/tags/aws.html">aws</a> (9)
              </li>
              <li>
                <a href="/tags/banking.html">banking</a> (1)
              </li>
              <li>
                <a href="/tags/bootstrap.html">bootstrap</a> (1)
              </li>
              <li>
                <a href="/tags/deutsch.html">deutsch</a> (1)
              </li>
              <li>
                <a href="/tags/docker.html">docker</a> (8)
              </li>
              <li>
                <a href="/tags/futurework.html">futureWork</a> (5)
              </li>
              <li>
                <a href="/tags/googleapps.html">googleapps</a> (1)
              </li>
              <li>
                <a href="/tags/gradle.html">gradle</a> (2)
              </li>
              <li>
                <a href="/tags/grails.html">grails</a> (2)
              </li>
              <li>
                <a href="/tags/inspiration.html">inspiration</a> (2)
              </li>
              <li>
                <a href="/tags/legal.html">legal</a> (1)
              </li>
              <li>
                <a href="/tags/meteor.html">meteor</a> (3)
              </li>
              <li>
                <a href="/tags/microservice.html">microservice</a> (12)
              </li>
              <li>
                <a href="/tags/modeling.html">modeling</a> (1)
              </li>
              <li>
                <a href="/tags/personaldata.html">personalData</a> (2)
              </li>
              <li>
                <a href="/tags/quicktips.html">quicktips</a> (12)
              </li>
              <li>
                <a href="/tags/shift.html">shift</a> (4)
              </li>
              <li>
                <a href="/tags/smallhints.html">smallhints</a> (13)
              </li>
              <li>
                <a href="/tags/startup.html">startup</a> (8)
              </li>
            </ul>
          </div>
          <div class="well">
            <h4>
              By year
            </h4>
            <ol>
              <li>
                <a href="/2016.html">2016</a> (3)
              </li>
              <li>
                <a href="/2015.html">2015</a> (37)
              </li>
              <li>
                <a href="/2014.html">2014</a> (10)
              </li>
            </ol>
          </div>
        </div>
      </div>
    </div>
    <script src="../../../js/all.js" type="text/javascript"></script>
  </body>
</html>