<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="IE=edge;chrome=1" http-equiv="X-UA-Compatible" />
    <title>dev@cloudburo | The Anatomy of a EB based Microservice - AWS Security Configuration</title>
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" /><!--[if lt IE 9]><script src="../../../js/ie8.js" type="text/javascript"></script><![endif]--><link href="../../../css/all.css" media="screen" rel="stylesheet" type="text/css" /><script type="text/javascript">
      (function(d,e,j,h,f,c,b){d.GoogleAnalyticsObject=f;d[f]=d[f]||function(){(d[f].q=d[f].q||[]).push(arguments)},d[f].l=1*new Date();c=e.createElement(j),b=e.getElementsByTagName(j)[0];c.async=1;c.src=h;b.parentNode.insertBefore(c,b)})(window,document,"script","//www.google-analytics.com/analytics.js","ga");ga("create","UA-35696879-1", location.hostname);ga("send","pageview");
    </script>
    <link href="/favicon.png" rel="icon" type="image/png" />
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro%3A400%2C400italic%2C700" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Varela+Round" rel="stylesheet" />
    <!--HTML5 shiv for IE8 support--><!--[if lt IE 9]
    | <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script-->
  </head>
  <body>
    <div class="col-sm-3 sidebar" id="secondary" style="display: none;">
      <aside>
        <div class="about">
          <h4>
            <a class="sidebarlink" href="/"><i class="fa fa-chevron-right"></i>    Home     <i class="fa fa-home"></i></a>
          </h4>
          <h4>
            <a class="sidebarlink" href="/menu1.html"><i class="fa fa-chevron-right"></i>    About   </a>
          </h4>
          <h4>
            <a class="sidebarlink" href="/menu2.html"><i class="fa fa-chevron-right"></i>    Contact   </a>
          </h4>
        </div>
        <div class="tags">
          <h4>
            Categories
          </h4>
          <ul class="list-unstyled">
            <a class="label label-default" href="/tags/api.html">api (2)</a>
            <a class="label label-default" href="/tags/architecture.html">architecture (17)</a>
            <a class="label label-default" href="/tags/aws.html">aws (12)</a>
            <a class="label label-default" href="/tags/banking.html">banking (5)</a>
            <a class="label label-default" href="/tags/blockchain.html">blockchain (5)</a>
            <a class="label label-default" href="/tags/bots.html">bots (2)</a>
            <a class="label label-default" href="/tags/datascience.html">datascience (2)</a>
            <a class="label label-default" href="/tags/deutsch.html">deutsch (1)</a>
            <a class="label label-default" href="/tags/docker.html">docker (9)</a>
            <a class="label label-default" href="/tags/futurework.html">futureWork (5)</a>
            <a class="label label-default" href="/tags/googleapps.html">googleapps (1)</a>
            <a class="label label-default" href="/tags/gradle.html">gradle (2)</a>
            <a class="label label-default" href="/tags/inspiration.html">inspiration (3)</a>
            <a class="label label-default" href="/tags/javatutorial.html">javatutorial (3)</a>
            <a class="label label-default" href="/tags/legal.html">legal (1)</a>
            <a class="label label-default" href="/tags/meteor.html">meteor (5)</a>
            <a class="label label-default" href="/tags/microservice.html">microservice (14)</a>
            <a class="label label-default" href="/tags/modeling.html">modeling (1)</a>
            <a class="label label-default" href="/tags/personaldata.html">personalData (3)</a>
            <a class="label label-default" href="/tags/quicktips.html">quicktips (14)</a>
            <a class="label label-default" href="/tags/shift.html">shift (4)</a>
            <a class="label label-default" href="/tags/smallhints.html">smallhints (13)</a>
            <a class="label label-default" href="/tags/startup.html">startup (11)</a>
          </ul>
        </div>
        <div class="timeline">
          <h4>
            By year
          </h4>
          <ul class="list-unstyled">
            <a class="label label-primary" href="/2017.html">2017 (11)</a>
            <a class="label label-primary" href="/2016.html">2016 (16)</a>
            <a class="label label-primary" href="/2015.html">2015 (35)</a>
            <a class="label label-primary" href="/2014.html">2014 (10)</a>
          </ul>
        </div>
      </aside>
    </div>
    <!--/#secondary-->
    <div class="col-sm-12" id="primary">
      <div class="content">
        <header class="header">
          <hgroup class="pull-left">
            <h1 class="site-title">
              <a href="/">dev@cloudburo</a>
            </h1>
          </hgroup>
          <div class="btn btn-primary pull-right" id="togglesidebar">
            <i class="fa fa-bars"></i>
          </div>
        </header>
        <section class="post">
          <header class="entry-header">
            <h2 class="entry-title">
              <a href="/2015/12/20/the-anatomy-of-a-eb-based-microservice-aws-security-configuration.html">The Anatomy of a EB based Microservice - AWS Security Configuration</a>
            </h2>
            <p class="entry-meta">
              Posted on  20.Dec 2015 | Tags <a class="label label-primary" href="/tags/docker.html">docker</a> <a class="label label-primary" href="/tags/microservice.html">microservice</a> <a class="label label-primary" href="/tags/architecture.html">architecture</a> <a class="label label-primary" href="/tags/aws.html">aws</a> 
            </p>
          </header>
          <div class="entry-description"><div class="row">
  <div class="article">
    <p><span/>      <div>
        Our microservice(s) will be managed by the
       <a href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/Welcome.html?console_help=true">AWS Elastic Beanstalk</a> Docker service. With Elastic Beanstalk, you can quickly deploy and manage applications in the AWS cloud without worrying about the infrastructure that runs those applications. AWS Elastic Beanstalk reduces management complexity without restricting choice or control.
      </div>
      <div>
       <br>
      </div>
      <div>
        Nevertheless quite some configuration is still required, which should be standardized in order to allow to automate these steps. One aspect to consider is the Security configuration of your EB instances which are steering the mircoservices.
      </div>
      <div>
       <br>
      </div>
      <div>
        Standardize the necessary roles and policies from the beginning (amongst other by using a naming scheme) which will help you during the automation of the tasks.
      </div>
      <div>
       <br>
      </div>
      <div>
        It&rsquo;s important that you understand the major concepts in context of the AWS Identity and Access Management (IAM capability):
      </div>
      <div>
       <br>
      </div>
      <ul>
       <li><strong><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html">IAM Policies</a>,</strong> which are documents that formally states on or more permissions. In its most basic sense a policy lets you specify
        <ul>
         <li>Actions: What actions you will allow of a dedicated AWS service.</li>
         <li>Resources: Which resources you allow the action on.</li>
         <li>Effect: What the effect will be when the user requests access - either allow or deny.<br></li>
        </ul></li>
       <li><strong><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/id.html">IAM Identities</a></strong>,which are the identities for which a formally documented policies can be allocated to. An identity can be<br>
        <ul>
         <li>An <strong>IAM user</strong> is an entity that you create in AWS. The IAM user represents the person or service who uses the IAM user to interact with AWS.<br></li>
         <li>An <strong>IAM group</strong> is a collection of IAM users. You can use groups to specify permissions for a collection of users, which can make those permissions easier to manage for those users.<br></li>
         <li>An <strong>IAM role</strong> is very similar to a user, in that it is an identity with permission policies that determine what the identity can and cannot do in AWS. However, a role does not have any credentials (password or access keys) associated with it. Instead of being uniquely associated with one person, a role is intended to be assumable by anyone who needs it.</li>
        </ul></li>
       <li>KMS Encryption Key, which is a AWS managed and controlled encryption key provided as part of the AWS Key Management System</li>
       <li>EC2 Key Pair, which allows you to establish a SSH remote connection to your EB instance.</li>
      </ul>
      <div>
       <br>
      </div>
      <div>
       <span style="font-size: 18px;"><strong>EB required IAM roles</strong></span>
       <br>
      </div>
      <div>
       <br>
      </div>
      <div>
        An EB environment requires two
       <a href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/concepts-roles.html#concepts-roles-instance">IAM roles</a> for correct functioning. These are
      </div>
      <ul>
       <li>EB Service Role</li>
       <li>EB Instance Profile Role</li>
      </ul>
      <div>
       <br>
      </div>
      <div>
       <strong>Service Role</strong>
      </div>
      <div>
       <br>
      </div>
      <div>
        A Service Role grants the EB instance access to use other AWS services on your behalf.
      </div>
      <div>
       <br>
      </div>
      <div>
        We create a policy which is globally defined and can be integrated in any microservice EB environment.
      </div>
      <ul>
       <li>We call it <em><span style="">TST.EB.serviceRolePolicy</span></em></li>
       <li>The <a href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/concepts-roles.html#concepts-roles-instance">link</a>, will explain the policy document content</li>
      </ul>
      <div>
        Having done that we create now a Service Role. We decide here to define a role on a microservice level to be flexible for the future.
      </div>
      <ul>
       <li>We call it <em><span style="">tst.&lt;microserviceName&gt;Service</span></em></li>
       <li>We attach the policy to the role</li>
      </ul>
      <div>
       <br>
      </div>
      <div></p>
    
  </div>
  <img class="img-responsive img-thumbnail article" src="/images/f8d95ed7ff125aa60aba4aa0236d5b45.png" />
  <div class="article">
    <p><span/>        </div>
      <div></p>
    
    <p><br>
      </div>
      <div>
       <strong>Instance Profile Role</strong>
      </div>
      <div>
       <br>
      </div>
      <div>
        An Instance Profile Role grants the EB instance permission to call AWS services for features including enhanced health reporting and container management.
      </div>
      <div>
       <br>
      </div>
      <div>
        We create policy which is which is globally defined and can be integrated in any microservice EB environment.
      </div>
      <ul>
       <li>We call it <em><span style="">TST.EB.instanceProfilePolicy</span></em><br></li>
       <li>The <a href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/concepts-roles.html#concepts-roles-instance">link</a>, will explain the policy document content, it will contain policies for<br>
        <ul>
         <li>Write logs to Amazon Simple Storage Service</li>
         <li>Coordinate container deployments with Amazon EC2 Container Service in multicontainer Docker environments</li>
         <li>In worker environments, read from an Amazon Simple Queue Service (Amazon SQS) queue</li>
         <li>In worker environments, perform leader election with Amazon DynamoDB</li>
         <li>In worker environments, publish instance health metrics to Amazon CloudWatch</li>
        </ul></li>
      </ul>
      <div>
        Having done that we create now a Instance Profile Role. We decide here to define a role on a microservice level to be flexible for the future.
      </div>
      <ul>
       <li>We call it  <em><span style="">tst.&lt;microserviceName&gt;</span></em></li>
       <li>We attach the Instance Profile default policy to the role</li>
      </ul>
      <div>
       <br>
      </div>
      <div></p>
    
  </div>
  <img class="img-responsive img-thumbnail article" src="/images/7e0fc0c501d8124e474caa2e8f0836e8.png" />
  <div class="article">
    <p><span/>        </div>
      <div>
       <br>
      </div>
      <div>
       <div>
         So now we have defined two roles with the necessary policies, which must be configured to our EB environment template which is used as a configuration for each EB instance.
       </div>
       <div>
        <br>
       </div>
       <div>
         Each instance created by EB will have this IAM roles allocated and obviously your IAM Roles will have multiple policies attached dependent on your microservice integration into the AWS ecosystem.
       </div>
       <div>
        <br>
       </div>
       <div>
        <strong>Allocate the two roles to your EB environment configuration</strong>
        <br>
       </div>
       <div>
        <strong><br></strong>
       </div>
       <div>
         The Instance Profile Role will be allocated in the EB Dashboard as part of the &ldquo;Instances&rdquo; tab.
       </div>
      </div>
      <div>
       <br>
      </div>
      <div>
        The Service Role  will be allocated in the EB Dashboard as part of the &ldquo;Health&rdquo; tab.
      </div>
      <div></p>
    
  </div>
  <img class="img-responsive img-thumbnail article" src="/images/8b3214495d802368ea57173314bea657.png" />
  <div class="article"><p><span/>        </div>
  <div>
   <br>In case you are automating the environment creation process with the help of the
   <a href="https://aws.amazon.com/cli/">AWS Command Line Interface</a> (CLI) you should include the following option settings, which are passed as part of the
   <em>-<span style="">-option-settings</span></em> parameter
  </div>
  <div>
   <br>
  </div>
  <div></p>
<pre class="highlight json"><code><span class="w">
  </span><span class="p">{</span><span class="w"> 
</span><span class="s2">"Namespace"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aws:autoscaling:launchconfiguration"</span><span class="p">,</span><span class="w"> 
  </span><span class="s2">"OptionName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"IamInstanceProfile"</span><span class="p">,</span><span class="w"> 
  </span><span class="s2">"Value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tst.curationPlatform"</span><span class="w"> 
  </span><span class="p">}</span><span class="err">,</span><span class="w"> 
</span><span class="p">{</span><span class="w"> 
</span><span class="s2">"Namespace"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aws:elasticbeanstalk:environment"</span><span class="p">,</span><span class="w"> 
</span><span class="s2">"OptionName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ServiceRole"</span><span class="p">,</span><span class="w"> 
</span><span class="s2">"Value"</span><span class="p">:</span><span class="w"> </span><span class="err">„tst.curationPlatformService"</span><span class="w"> 
</span><span class="p">}</span><span class="err">,</span><span class="w"> 


</span></code></pre>

<p></div>
  <div>
   <br>
  </div>
  <div>
   <span style="font-size: 18px;"><strong>KMS Encryption Key</strong></span>
  </div>
  <div>
   <strong><span style="font-size: 18px;"><br></span></strong>
  </div>
  <div>
    Beside the two roles, we will define an Encryption Key provided by the
   <a href="http://docs.aws.amazon.com/kms/latest/developerguide/overview.html">AWS Key Management Service</a> (KMS). The AWS Key Management Service (AWS KMS) is a managed service that makes it easy for you to create and control the encryption keys used to encrypt your data.
  </div>
  <div>
   <br>
  </div>
  <div>
    Again an Encryption Key is provided per region, where the EB instance will run.
  </div>
  <div>
   <br>
  </div>
  <div>
    From a naming point of view we will not code the region postfix, due to the fact that you can define the same encryption key on a per region level.
  </div>
  <div>
   <br>
  </div>
  <div>
    So we will call our key
   <span style=""><em>tst_ms_&lt;microserviceName&gt;</em>.</span>
  </div>
  <div>
   <span style=""><br></span>
  </div>
  <div>
    As a key user(s) we assign the role of
   <em><span style="">tst.curationPlatform</span></em>, i.e. our Elastic Beanstalk Microservice will be able to encrypt and decrypt sensitive data at rest (= in our S3 buckets). 
  </div>
  <div>
   <br>
  </div>
  <div>
   <strong><span style="font-size: 18px;">EC2 Key Pair to Enable Remote Login</span></strong>
  </div>
  <div>
   <br>
  </div>
  <div>
    In order to enable remote login into your Elastic Beanstalk Environment you have to create a EC2 key pair and configure it into your EB configuration.
  </div>
  <div>
   <br>
  </div>
  <div>
    You can find the description 
   <a href="https://dev.cloudburo.net/2015/04/25/docker-small-hints-3-ssh-into-your-aws-elastic-beanstalk-component.html">Docker Small Hints #3: SSH into your AWS Elastic Beanstalk Component</a>
  </div>
  <div>
   <br>
   <br>
  </div></p>

  </div>
</div>
          </div>
          <div class="comments">
            <div id="disqus_thread">
              <div id="disqus_thread"></div>
              <script type="text/javascript">
              //<![CDATA[
                                var disqus_shortname = 'dev1cloudburo';
                        
                  (function() {
                      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                  })();
              //]]>
              </script>
              <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
              <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
              <script type="text/javascript">
              //<![CDATA[
                  var disqus_shortname = 'dev1cloudburo';
                  (function () {
                      var s = document.createElement('script'); s.async = true;
                      s.type = 'text/javascript';
                      s.src = '//' + disqus_shortname + '.disqus.com/count.js';
                      (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
                  }());
              //]]>
              </script>
              
            </div>
          </div>
        </section><footer class="footer">
          <p>
          </p>
          <div class="socials-footer"><a class="btn btn-twitter" href="https://twitter.com/talfco">
                <i class="fa fa-twitter"></i></a><a class="btn btn-facebook" href="https://www.facebook.com/Cloudburonet-897759390318816/">
                <i class="fa fa-facebook"></i></a><a class="btn btn-google-plus" href="https://plus.google.com/u/1/b/102868953630532463137/+CloudburoCh/posts">
                <i class="fa fa-google-plus"></i></a><a class="btn btn-linkedin" href="https://www.linkedin.com/in/felixk">
                <i class="fa fa-linkedin"></i></a><a class="btn btn-github" href="https://github.com/talfco">
                <i class="fa fa-github"></i></a>
          </div>
          <p>
            © 2017 All rights reserved 
          </p>
        </footer>
      </div>
    </div>
    <script src="../../../js/all.js" type="text/javascript"></script>
  </body>
</html>